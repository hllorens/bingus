var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
var config={apiKey:"AIzaSyDn6s-P6h6MB-PKXKRaBHFvkaPBbyKssLg",authDomain:"cult-game.firebaseapp.com",databaseURL:"https://cult-game.firebaseio.com",storageBucket:"cult-game.appspot.com",messagingSenderId:"718126583517"};firebase.initializeApp(config);var firebaseCodec={encodeFully:function(a){return encodeURIComponent(a).replace(/\./g,"%2E")},decode:function(a){return decodeURIComponent(a)}},noSleep=null;
/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(noSleep=new NoSleep);
var zombie_strategy="just_take_lidership",activity_timer=new ActivityTimer,session={},reset_local_game=function(){var a="";session.hasOwnProperty("user")&&(a=session.user);session={challenge_name:"",user:a,timestamp:new Date,level:"normal",used_messages:[],beat:0,beat_utc:0,beat_timeout:null,beat_timeout_duration:9E3,last_challenge_beat_snapshot:{},zombies_to_kill:[],challenge:null,game:{cm:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],tmpError:""}};activity_timer.reset()};reset_local_game();
var canvas_zone_vcentered=document.getElementById("zone_canvas_vcentered");
function menu_screen(){/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&noSleep.disable();allowBackExit();console.log("menu_screen user: ("+session.user+")");var a=document.getElementById("splash_screen");null!=a&&a.parentNode.removeChild(a);a="";mobile_without_wakelock&&(a=":-( mob_wo_wakelock="+mobile_without_wakelock);canvas_zone_vcentered.innerHTML='     <div id="menu-logo-div"></div>     <nav id="responsive_menu">    <span style="font-size:9vw;color:#0b5394;font-weight:bold;">BINGO</span><br /><span style="font-family:cursive;font-size:4vw;">\u00a1para TODOS!</span><br />    <br /><button id="create-button" class="coolbutton">Crear partida</button>     <br /><button id="join-button" class="coolbutton">Unirse a partida</button>    </nav>    <br /><br /><span id="spaninfo" style="font-size:0.7vw">'+a+
" is_app="+is_app+"</span>     ";is_app&&admob.showBannerAd(!1,function(){document.getElementById("spaninfo").innerHTML+='<br /><br /><span style="font-size:0.7vw;">BANNER OK</span>'},function(){document.getElementById("spaninfo").innerHTML+='<br /><br /><span style="font-size:0.7vw;">BANNER FAIL</span>'});document.getElementById("create-button").addEventListener(clickOrTouch,function(){challenge_form("crear")});document.getElementById("join-button").addEventListener(clickOrTouch,function(){challenge_form("unirse")})}
function challenge_form(a){reset_local_game();canvas_zone_vcentered.innerHTML='           <span style="font-variant: small-caps;font-size:4vw;">Partida:</span> <input class="coolinput" id="challenge_name" pattern="[a-zA-Z0-9]+"  maxlength="15"/><br />          <span style="font-variant: small-caps;font-size:4vw;">Jugador:</span> <input class="coolinput" id="jugador" value="'+session.user+'"  maxlength="10"/><br />        <button class="coolbutton" id="'+a+'">'+a+'</button>        <br /><button id="go-back" class="minibutton fixed-bottom-right go-back">&lt;</button>         ';
document.getElementById("challenge_name").focus();document.getElementById("challenge_name").addEventListener("keyup",function(a){!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&a.keyCode&&13===a.keyCode&&(a.preventDefault(),document.getElementById("jugador").focus())});document.getElementById("jugador").addEventListener("keyup",function(b){!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&b.keyCode&&13===b.keyCode&&(b.preventDefault(),
document.getElementById(a).click())});document.getElementById(a).addEventListener("click",function(b){b=document.getElementById("challenge_name").value.toLowerCase().trim();var c=document.getElementById("jugador").value.toLowerCase().trim();c=c.substr(0,11).trim().replace(/\s+/gi,"_");c=c.charAt(0).toUpperCase()+c.slice(1);0==c.length?alert('"'+c+'" no puede estar vac\u00edo'):session.user=c;0==b.length||null!=b.match(/[^a-z0-9]/)?alert('Nombre partida="'+b+'" no es v\u00e1lido o est\u00e1 vac\u00edo. Use s\u00f3lo letras sin acento y n\u00fameros (sin espacios).'):
(session.challenge_name=b,firebase.database().ref().child("challenges/"+b).once("value",function(b){challenge_form_action(b.val(),a)}.bind(this)))});document.getElementById("go-back").addEventListener(clickOrTouch,function(){menu_screen()})}
function challenge_form_action(a,b){var c={},e=[];do e=random_carton();while(!check_carton(e));e={role:"invitee",beat:"active",score:0,lifes:3,answer:"",carton:e};if("crear"==b){e.role="inviter";if(void 0!=a&&null!=a&&"null"!=a&&""!=a){alert('el nombre de partida "'+session.challenge_name+'" ya existe, elige otro');session.challenge_name="";return}var d={name:session.challenge_name,time_left:60,timestamp:get_timestamp_str(),question:"",linea:"",cantadores:[""],answer_options:["",""],answer_msg:"",
game_status:"waiting",u:{}};d.u[session.user]=e;c["challenges/"+session.challenge_name]=d;c["challenges-beat/"+session.challenge_name]={u:{}}}else{if(null==a||void 0==a||"null"==a||""==a){alert("La partida "+session.challenge_name+" no existe \u00bfseguro que se llama as\u00ed?");session.challenge_name="";return}if("waiting"!=a.game_status){alert("La partida "+session.challenge_name+" ya ha empezado. Has llegado tarde.");session.challenge_name="";return}if(a.u.hasOwnProperty(session.user)){alert('El jugador "'+
session.user+'" ya existe. Elige otro nombre.');return}if(29<Object.keys(a.u).length){alert("No caben m\u00e1s jugadores (max 30).");return}c={};c["challenges/"+session.challenge_name+"/u/"+session.user]=e}/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&noSleep.enable();session.beat_timeout=setTimeout(function(){handle_beat()}.bind(this),session.beat_timeout_duration);firebase.database().ref().update(c);console.log(b+" partida "+session.challenge_name);firebase.database().ref().child("challenges/"+
session.challenge_name).on("value",function(a){listen_challenge(a.val())})}
function handle_beat(){session.beat++;session.beat_utc=new Date;session.beat_timeout=setTimeout(function(){handle_beat()}.bind(this),session.beat_timeout_duration);var a={};a["challenges-beat/"+session.challenge_name+"/u/"+session.user+"/beat"]=session.beat;a["challenges-beat/"+session.challenge_name+"/u/"+session.user+"/beat_utc"]=session.beat_utc;session.challenge&&session.challenge.u&&"active"!=session.challenge.u[session.user].beat&&(a["challenges/"+session.challenge_name+"/u/"+session.user+"/beat"]=
"active");firebase.database().ref().update(a);firebase.database().ref().child("challenges-beat/"+session.challenge_name).once("value",function(a){handle_zombies(a.val())})}
function handle_zombies(a){if(null==a||void 0==a)alert("challenge_beat is null, reset_local_game"),/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&noSleep.disable(),reset_local_game();else if(null==session.last_challenge_beat_snapshot||Object.keys(session.last_challenge_beat_snapshot).length!=Object.keys(a.u).length)session.last_challenge_beat_snapshot=a.u,console.log("initialize zombies_beat");else for(var b in a.u)if(b!=session.user)if(a.u[b].beat==session.last_challenge_beat_snapshot[b].beat&&
"inactive"!=session.challenge.u[b].beat)if(console.log("is "+b+" a zombie "+a.u[b].beat+" ("+session.last_challenge_beat_snapshot[b].beat+")? to kill ("+session.zombies_to_kill.join(", ")+")"),-1==session.zombies_to_kill.indexOf(b))console.log(b+" zombie candidate"),session.zombies_to_kill.push(b);else{var c=get_session_master(a);if(b==c||"inactive"==session.challenge.u[b].beat){console.log("find new leader");for(var e in a.u)if(-1==session.zombies_to_kill.indexOf(e)&&"inactive"!=session.challenge.u[b].beat){c=
e;console.log("new leader="+e);break}}if(c==session.user)if(console.log("I ("+session.user+") will kill the zombie: "+b),"kill"==zombie_strategy)firebase.database().ref().child("challenges/"+session.challenge_name+"/u/"+b).remove(),firebase.database().ref().child("challenges-beat/"+session.challenge_name+"/u/"+b).remove(),null!=session.challenge&&"playing"==session.challenge.game_status&&(activity_timer.start(),c={},c["challenges/"+session.challenge_name+"/question"]="<b>"+b+"</b> se ha desconectado,<br />el resto,",
firebase.database().ref().update(c));else{var d={};"inviter"==session.challenge.u[b].role&&(d["challenges/"+session.challenge_name+"/u/"+b+"/role"]="invitee",d["challenges/"+session.challenge_name+"/u/"+c+"/role"]="inviter");null!=session.challenge&&"playing"==session.challenge.game_status&&(activity_timer.start(),d["challenges/"+session.challenge_name+"/question"]="<b>"+b+"</b> se ha desconectado,<br />el resto,");-1!=session.zombies_to_kill.indexOf(b)&&session.zombies_to_kill.splice(session.zombies_to_kill.indexOf(b),
1);d["challenges/"+session.challenge_name+"/u/"+b+"/beat"]="inactive";firebase.database().ref().update(d)}else console.log(c+" leader will kill zombie: "+b)}else session.last_challenge_beat_snapshot[b]=a.u[b],-1!=session.zombies_to_kill.indexOf(b)&&(console.log("quito '"+b+"' de candidatos a zombie"),session.zombies_to_kill.splice(session.zombies_to_kill.indexOf(b),1));else session.last_challenge_beat_snapshot[b]=a.u[b]}
function listen_challenge(a){console.log("challenge:"+JSON.stringify(a));session.challenge=a;if(null==a||void 0==a)-1==canvas_zone_vcentered.innerHTML.indexOf("GAME OVER")?(canvas_zone_vcentered.innerHTML='               GAME CANCELLED! <br />Sayonara baby!<br /><br />              <button class="coolbutton" id="accept_over">inicio</button>            <br />            ',document.getElementById("accept_over").addEventListener(clickOrTouch,function(){menu_screen()})):-1==canvas_zone_vcentered.innerHTML.indexOf("GAME CANCELLED")&&
(canvas_zone_vcentered.innerHTML+="GAME CANCELLED! <br />Sayonara baby!<br /><br />"),cancel_challenge();else if("over"==a.game_status)activity_timer.stop(),console.log("challenge over!"),canvas_zone_vcentered.innerHTML="           GAME OVER! <br /><br />Cantado por:"+a.cantadores.join(", ")+"<br />"+get_winner_string(a)+'<br />          <button class="coolbutton" id="accept_over">accept</button>        <br />        <br /><span id="spaninfo" style="font-size:0.7vw">is_app='+is_app+"</span>         ",
is_app?admob.showBannerAd(!0,function(){document.getElementById("spaninfo").innerHTML+='<br /><br /><span style="font-size:0.7vw;">BANNER OK</span>'},function(){document.getElementById("spaninfo").innerHTML+='<br /><br /><span style="font-size:0.7vw;">BANNER FAIL</span>'}):is_local()||(canvas_zone_vcentered.innerHTML+='<ins class="adsbygoogle" style="display:block" data-ad-format="fluid"             data-ad-layout-key="-fb+5w+4e-db+86"             data-ad-client="ca-pub-1143362957092180"             data-ad-slot="3596710175"></ins>',
(adsbygoogle=window.adsbygoogle||[]).push({})),document.getElementById("accept_over").addEventListener(clickOrTouch,function(){cancel_challenge_prompt(a,!1)});else if("waiting"==a.game_status){var b="",c=get_inviter();b=session.user==c&&1<Object.keys(a.u).filter(function(b){return"active"==a.u[b].beat}).length?'<button class="coolbutton" id="start_challenge">empezar</button>':'<br /><br/>"'+c+'" decidir\u00e1 cuando empezar (min: 2 jug)';canvas_zone_vcentered.innerHTML="               PARTIDA: <b>"+
session.challenge_name+"</b><br/>de momento somos <b>"+Object.keys(a.u).length+'</b><br/><br/>              <table id="players">            <tr><td id="p1" class="filler" style="width:50%">&nbsp;</td><td id="p2" class="filler" style="width:50%">&nbsp;</td></tr>            <tr><td id="p3" class="filler">&nbsp;</td><td id="p4" class="filler">&nbsp;</td></tr>            <tr><td id="p5" class="filler">&nbsp;</td><td id="p6" class="filler">&nbsp;</td></tr>            <tr><td id="p7" class="filler">&nbsp;</td><td id="p8" class="filler">&nbsp;</td></tr>            <tr><td id="p9" class="filler">&nbsp;</td><td id="p10" class="filler">&nbsp;</td></tr>            </table>              '+
b+'            <br /><button id="go-back" class="minibutton fixed-bottom-right go-back">&lt;</button>             ';for(b=1;b<=Object.keys(a.u).length;b++){var e=document.getElementById("p"+b),d="",g=Object.keys(a.u)[b-1];if(10<b){document.getElementById("p10").innerHTML="y m\u00e1s...";break}"active"!=a.u[g].beat&&(d="[inactivo]");e.innerHTML=g==session.user?g+" (t\u00fa) "+d:""+g+" "+d}console.log("inviter:"+c);session.user==c&&1<Object.keys(a.u).length&&document.getElementById("start_challenge").addEventListener(clickOrTouch,
function(){var a={};a["challenges/"+session.challenge_name+"/game_status"]="playing";a["challenges/"+session.challenge_name+"/bolas"]=[0,0,0];firebase.database().ref().update(a);activity_timer.start()});document.getElementById("go-back").addEventListener(clickOrTouch,function(){cancel_challenge_prompt(a)}.bind(a))}else if("playing"==a.game_status)if(2>Object.keys(a.u).length&&(console.log("canceling game, only 1 player alive"),cancel_challenge_prompt(a,!1)),""!=a.question)canvas_zone_vcentered.innerHTML=
"                   "+a.question+"                    <br />                 ...continuamos en 5 segundos...                <br />                ";else{c=session.challenge.bolas.slice(-3);b='<button class="coolbutton" id="linea">Linea</button>';""!=a.linea&&(b="");var f="";11<session.game.cm.reduce(function(a,b){return a+b},0)&&-1==session.used_messages.indexOf("me quedan pocas")?f='<button class="coolbutton" id="special_str">me quedan pocas</button>':6>session.game.cm.reduce(function(a,b){return a+
b},0)&&20<session.challenge.bolas.length-3&&-1==session.used_messages.indexOf("no marco")?f='<button class="coolbutton" id="special_str">no marco</button>':10>session.game.cm.reduce(function(a,b){return a+b},0)&&60<session.challenge.bolas.length-3&&-1==session.used_messages.indexOf("no marco")&&(f='<button class="coolbutton" id="special_str">no marco</button>');canvas_zone_vcentered.innerHTML='                   <table id="bolas"><tr>                    <td style="font-size:2vw">bola<br />'+(session.challenge.bolas.length-
3)+'</td>                    <td><b style="font-size:5vw">'+c[2]+"</b></td>                    <td>"+c[1]+"</td>                    <td>"+c[0]+'</td>                  </tr></table>                  <table id="carton">                    <tr>                        <td id="square0" class="filler">&nbsp;</td>                        <td id="square3" class="filler">&nbsp;</td>                        <td id="square6" class="filler">&nbsp;</td>                        <td id="square9" class="filler">&nbsp;</td>                        <td id="square12" class="filler">&nbsp;</td>                        <td id="square15" class="filler">&nbsp;</td>                        <td id="square18" class="filler">&nbsp;</td>                        <td id="square21" class="filler">&nbsp;</td>                        <td id="square24" class="filler">&nbsp;</td>                    </tr>                    <tr>                        <td id="square1" class="filler">&nbsp;</td>                        <td id="square4" class="filler">&nbsp;</td>                        <td id="square7" class="filler">&nbsp;</td>                        <td id="square10" class="filler">&nbsp;</td>                        <td id="square13" class="filler">&nbsp;</td>                        <td id="square16" class="filler">&nbsp;</td>                        <td id="square19" class="filler">&nbsp;</td>                        <td id="square22" class="filler">&nbsp;</td>                        <td id="square25" class="filler">&nbsp;</td>                    </tr>                    <tr>                        <td id="square2" class="filler">&nbsp;</td>                        <td id="square5" class="filler">&nbsp;</td>                        <td id="square8" class="filler">&nbsp;</td>                        <td id="square11" class="filler">&nbsp;</td>                        <td id="square14" class="filler">&nbsp;</td>                        <td id="square17" class="filler">&nbsp;</td>                        <td id="square20" class="filler">&nbsp;</td>                        <td id="square23" class="filler">&nbsp;</td>                        <td id="square26" class="filler">&nbsp;</td>                    </tr>                </table>                 '+
f+"                 "+b+'                 <button id="bingo"  class="coolbutton">BINGO</button> <br />                <br /><button id="go-back" class="minibutton fixed-bottom-right go-back">&lt;</button><br />                ';print_card(session.challenge.u[session.user].carton);""!=f&&document.getElementById("special_str").addEventListener(clickOrTouch,function(){var a={};f=f.replace(/<[^>]*>?/gm,"");session.used_messages.push(f);switch(f){case "me quedan pocas":f="Me quedan pocas, voy a ganar ;-)";
break;case "no marco":f="\u00a1No marco ni a la de tres! :-(";break;default:f="No se que iba a decir..."}a["challenges/"+session.challenge_name+"/question"]="<b>"+session.user+"</b> dice: "+f;firebase.database().ref().update(a)});""!=b&&document.getElementById("linea").addEventListener(clickOrTouch,function(){check_linea()});document.getElementById("bingo").addEventListener(clickOrTouch,function(){check_bingo()});document.getElementById("go-back").addEventListener(clickOrTouch,function(){cancel_challenge_prompt(a)}.bind(a))}}
function cancel_challenge_prompt(a,b){"undefined"==typeof b&&(b=!0);var c=!0;b&&(c=confirm("\u00bfSeguro que quieres salir, el juego parar\u00e1 para todos los jugadores?"));1==c&&(c={},console.log("canceling "+JSON.stringify(a)),c["challenges/"+session.challenge_name]=null,c["challenges-beat/"+session.challenge_name]=null,firebase.database().ref().update(c))}
function cancel_challenge(){clearTimeout(session.beat_timeout);firebase.database().ref().child("challenges/"+session.challenge_name).off();firebase.database().ref().child("challenges-beat/"+session.challenge_name).off();firebase.database().ref().child("challenges/"+session.challenge_name).remove();firebase.database().ref().child("challenges-beat/"+session.challenge_name).remove();reset_local_game();console.log("challenge canceled!")}var countdown_limit_end_secs=7;activity_timer.set_limit_end_seconds(countdown_limit_end_secs);
var timeout_callback=function(){activity_timer.reset();console.log("activity_timer timeout_callback");null!=session.challenge&&""!=session.challenge.question?setTimeout(function(){clear_msg()}.bind(this),7E3):new_number()};activity_timer.set_end_callback(timeout_callback);function clear_msg(){if(""!=session.challenge.question){var a={};console.log("cancelling msg ");a["challenges/"+session.challenge_name+"/question"]="";firebase.database().ref().update(a);activity_timer.start()}}var card=[];
function aleatorio(a,b,c){var e=[];if(!c||0>=c)return Math.floor(Math.random()*(b-a+1))+a;for(;e.length<c;){var d=Math.floor(Math.random()*(b-a+1))+a;-1==e.indexOf(d)&&e.push(d)}return e.sort(function(a,b){return a-b})}
function random_carton(){card=[];do var a=aleatorio(0,8,3);while(triad(a));console.log("cols1="+a);for(var b=0;9>b;b++){var c=aleatorio(b+9*b,b+9*(b+1),3);0==b&&(c=aleatorio(1,b+9*(b+1),3));8==b&&(c=aleatorio(80,90,3));var e=1;-1!=a.indexOf(b)&&(e=2);var d=aleatorio(0,2,e);if(2==b){var g=0;do if(0<g&&console.log("bad "+d.join(",")),d=aleatorio(0,2,e),console.log("trying "+d.join(",")),g++,30==g){console.log("had to break");break}while(-1!=d.indexOf(0)&&prev2blank(3*b,card)||-1!=d.indexOf(1)&&prev2blank(3*
b+1,card)||-1!=d.indexOf(2)&&prev2blank(3*b+2,card)||-1==d.indexOf(0)&&prev2notblank(3*b,card)||-1==d.indexOf(1)&&prev2notblank(3*b+1,card)||-1==d.indexOf(2)&&prev2notblank(3*b+2,card))}if(3<=b){g=0;do if(0<g&&console.log("bad "+d.join(",")),d=aleatorio(0,2,e),console.log("trying "+d.join(",")),g++,30==g){console.log("had to break");break}while(-1!=d.indexOf(0)&&prev2blank(3*b,card)||-1!=d.indexOf(1)&&prev2blank(3*b+1,card)||-1!=d.indexOf(2)&&prev2blank(3*b+2,card)||-1==d.indexOf(0)&&prev2notblank(3*
b,card)||-1==d.indexOf(1)&&prev2notblank(3*b+1,card)||-1==d.indexOf(2)&&prev2notblank(3*b+2,card)||-1!=d.indexOf(0)&&4<=row_blanks(0,card)||-1!=d.indexOf(1)&&4<=row_blanks(1,card)||-1!=d.indexOf(2)&&4<=row_blanks(2,card))}e=$jscomp.makeIterator(d);for(d=e.next();!d.done;d=e.next())c[d.value]=-1;card=card.concat(c)}return card}
function check_carton(a){for(var b=[],c=[],e=[],d=0;d<a.length;d++)0==d%3&&-1!=a[d]&&b.push(1),1==d%3&&-1!=a[d]&&c.push(1),2==d%3&&-1!=a[d]&&e.push(1);return 5!=b.length||5!=c.length||5!=e.length?(console.log("cart\u00f3n incorrecto. regenerar..."),!1):!0}function prev2blank(a,b){return 6>b.length||6>a?!1:-1==b[a-3]&&-1==b[a-6]?(console.log("2 blanks pos="+a),!0):!1}function prev2notblank(a,b){return 6>b.length||6>a?!1:-1!=b[a-3]&&-1!=b[a-6]?(console.log("2 NOT blanks pos="+a),!0):!1}
function row_blanks(a,b){for(var c=0,e=0;e<b.length;e++)e%3==a&&-1==b[e]&&c++;console.log("blanks row"+a+"="+c);return c}function triad(a){console.log(a.length);for(var b=0;b<a.length-2;b++)if(a[b]+1==a[b+1]&&a[b+1]+1==a[b+2])return!0;return!1}
function print_card(a){for(var b=0;27>b;b++)-1!=a[b]?(document.getElementById("square"+b).innerHTML=a[b],1!=session.game.cm[b]||document.getElementById("square"+b).classList.contains("marked")||document.getElementById("square"+b).classList.add("marked"),document.getElementById("square"+b).addEventListener(clickOrTouch,function(){mark(this.id)})):document.getElementById("square"+b).innerHTML="&#9825"}
function mark(a){a=a.substring(6,a.length);1==session.game.cm[a]?(document.getElementById("square"+a).classList.remove("marked"),session.game.cm[a]=0):(session.game.cm[a]=1,document.getElementById("square"+a).classList.add("marked"))}
function new_number(){if("inviter"==session.challenge.u[session.user].role)if(93>session.challenge.bolas.length){var a=0;a=Array(90);for(var b=0;b<a.length;b++)a[b]=b+1;a=a.filter(function(a){return!session.challenge.bolas.includes(a)});a=a[Math.floor(Math.random()*a.length)];session.challenge.bolas.push(a);a={};a["challenges/"+session.challenge_name+"/bolas"]=session.challenge.bolas;firebase.database().ref().update(a);activity_timer.start()}else activity_timer.stop(),a={},session.challenge.cantadores.push("..nadie.."),
""==session.challenge.cantadores[0]&&session.challenge.cantadores.shift(),a["challenges/"+session.challenge_name+"/game_status"]="over",a["challenges/"+session.challenge_name+"/cantadores"]=session.challenge.cantadores,b=session.timestamp,b=b.getFullYear()+"-"+pad_string(b.getMonth()+1,2,"0")+"-"+pad_string(b.getDate(),2,"0")+"_"+pad_string(b.getHours(),2,"0")+pad_string(b.getMinutes(),2,"0"),a["challenges-log/"+b+"_"+session.challenge_name+"/"]=session.challenge,firebase.database().ref().update(a)}
function auto_mark(){for(var a=session.user,b=$jscomp.makeIterator(session.challenge.u[a].carton),c=b.next();!c.done;c=b.next()){c=c.value;var e=session.challenge.u[a].carton.indexOf(c);-1!=c&&(-1==session.challenge.bolas.indexOf(c)?(session.game.cm[e]=0,document.getElementById("square"+e).classList.remove("marked")):(session.game.cm[e]=1,document.getElementById("square"+e).classList.add("marked")))}}
function is_bingo(a){"undefined"==typeof a&&(a=session.user);if(null==session.challenge||"undefined"==typeof session.challenge||"undefined"==typeof session.challenge.u[a].carton)return!1;for(var b=$jscomp.makeIterator(session.challenge.u[a].carton),c=b.next();!c.done;c=b.next()){c=c.value;var e=session.challenge.u[a].carton.indexOf(c);if(-1!=c&&-1==session.challenge.bolas.indexOf(c))return a==session.user&&(session.game.cm[e]=0,null!==document.getElementById("square"+e)&&document.getElementById("square"+
e).classList.remove("marked"),session.game.tmpError=c),!1}return!0}
function check_bingo(a){"undefined"==typeof a&&(a=session.user);if(is_bingo(a)){session.challenge.cantadores.push(a);""==session.challenge.cantadores[0]&&session.challenge.cantadores.shift();activity_timer.stop();a={};a["challenges/"+session.challenge_name+"/game_status"]="over";a["challenges/"+session.challenge_name+"/cantadores"]=session.challenge.cantadores;var b=session.timestamp;b=b.getFullYear()+"-"+pad_string(b.getMonth()+1,2,"0")+"-"+pad_string(b.getDate(),2,"0")+"_"+pad_string(b.getHours(),
2,"0")+pad_string(b.getMinutes(),2,"0");a["challenges-log/"+session.challenge_name+"_"+b+"/"]=session.challenge;firebase.database().ref().update(a)}else open_js_modal_content_accept("<br />El bingo no es correcto. El [["+session.game.tmpError+"]] no ha salido.<br /><br />"),session.game.tmpError=""}
function is_linea_x(a,b){"undefined"==typeof a&&(a=session.user);for(var c=$jscomp.makeIterator(b),e=c.next();!e.done;e=c.next()){e=e.value;var d=session.challenge.u[a].carton[e];if(-1!=d&&-1==session.challenge.bolas.indexOf(d))return a==session.user&&(session.game.cm[e]=0,document.getElementById("square"+e).classList.remove("marked"),session.game.tmpError=d),!1}return!0}
function is_linea(a){"undefined"==typeof a&&(a=session.user);return is_linea_x(a,[0,3,6,9,12,15,18,21,24])||is_linea_x(a,[1,4,7,10,13,16,19,22,25])||is_linea_x(a,[2,5,8,11,14,17,20,23,26])?!0:!1}
function check_linea(a){"undefined"==typeof a&&(a=session.user);var b={},c="<b>\u00a1"+a+"</b> ha cantado l\u00ednea!<br />";is_linea(a)?(c+=" la l\u00ednea es \u00a1<b>correcta</b>!<br />",b["challenges/"+session.challenge_name+"/linea"]=a):c+=" la l\u00ednea <b>no es correcta</b>.<br />El [["+session.game.tmpError+"]] no ha salido.<br />";b["challenges/"+session.challenge_name+"/question"]=c;firebase.database().ref().update(b)}
function get_inviter(){for(var a in session.challenge.u)if("inviter"==session.challenge.u[a].role)return a}var get_session_master=function(a){return Object.keys(a.u).sort()[0]};function get_winner_string(){var a=[],b;for(b in session.challenge.u)is_bingo(b)&&a.push(b);return"Ganadores ("+a.length+"): "+a.join(", ")}var QueryString=get_query_string(),debug=!1,user_bypass=void 0;QueryString.hasOwnProperty("debug")&&"true"==QueryString.debug&&(debug=!0);prevent_scrolling();
var mobile_without_wakelock=!1;!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"wakeLock"in navigator||"getWakeLock"in navigator||"requestWakeLock"in navigator||"WakeLock"in window||(mobile_without_wakelock=!0);var is_app=is_cordova();is_app?(console.log("is_app"),window.cordova||alert("ERROR: Running cordova without including cordova.js!"),document.addEventListener("deviceready",onDeviceReady,!1)):onDeviceReady();
function onDeviceReady(){document.removeEventListener("deviceready",onDeviceReady,!1);console.log("userAgent: "+navigator.userAgent+" is_app: "+is_app);is_app&&admob.createBannerView({publisherId:"ca-app-pub-3940256099942544/6300978111",adSize:admob.AD_SIZE.SMART_BANNER,tappxShare:0,bannerAtTop:!1,overlap:!0,autoShowBanner:!1,autoShowInterstitial:!1});menu_screen()};